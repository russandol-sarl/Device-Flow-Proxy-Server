{# templates/index.html.twig #}
{% extends 'layout.html.twig' %}

{% block title %}Entrez le code{% endblock %}

{% block content %}
<p>Enedis gère le réseau d’électricité jusqu’au compteur d’électricité. Cette page a pour but de lancer le consentement vous permettant d'autoriser Enedis à transmettre vos données Linky au plugin DomoticzLinky.</p>

<p>Pour donner votre autorisation, vous devez créer un compte personnel <a href="https://www.enedis.fr">Enedis</a>. Il vous permet également de suivre et gérer vos données de consommation et/ou de production en fonction de votre service d’électricité. Munissez-vous de votre facture d’électricité pour créer votre espace si vous ne l'avez pas déjà fait.</p>

<p>Si vous êtes sur cette page, c'est que le plugin DomoticzLinky a dû vous inviter à vous y rendre par un message dans Configuration / Log. Attention, si vous avez trop tardé, le code n'est peut-être plus valable. Pour relancer le processus et obtenir un code de nouveau valable, rendez-vous sous Domoticz dans Configuration / Matériel, cliquez sur le plugin et sur Modifier et surveillez les messages dans Configuration / Log.</p>

<p>En cliquant sur le bouton "Envoyer" ci-dessous, vous allez accéder à votre compte personnel Enedis où vous pourrez donner votre accord pour qu’Enedis transmette vos données au plugin DomoticzLinky.</p>

{% if code %}
<p>Veuillez confirmer que le code ci-dessous correspond au code donné dans les logs de Domoticz (dans Configuration / Log) par le plugin DomoticzLinky.</p>
{% else %}
<p>Pour continuer, entrez ci-dessous le code obtenu dans les logs de Domoticz (dans Configuration / Log).</p>
{% endif %}

<form action="{{ url('verify_code') }}" method="get">
<div style="text-align: center">
  <input type="text" name="code" placeholder="XXXX-XXXX" id="user_code" value="{{ code }}" autocomplete="off">
  <input type="hidden" name="state" value="{{ state }}">
  <p>
    <button type="submit" style="border: 0; padding: 0; width: 282px; height: 79px;" name="btnSubmit" title="Acc<C3><A9>der <C3><A0> mon espace Enedis">
      <img src="https://datahub-enedis.fr/wp-content/uploads/2018/11/blanc-txtbleu.png"/>
    </button>
  </p>
</div>
</form>

<script>
document.getElementById("user_code").focus();
</script>
{% endblock %}
